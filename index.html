<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tính Điểm Trận Đấu Pickleball</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .title {
            text-align: center;
            color: #2c3e50;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .game-setup {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .team-setup {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .team {
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 15px;
            background: white;
        }
        
        .team h3 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .player-input {
            margin-bottom: 10px;
        }
        
        .player-input label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #34495e;
        }
        
        .player-input input {
            width: 100%;
            padding: 8px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .serve-setup {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }
        
        .serve-setup label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .serve-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .serve-btn:hover:not(:disabled) {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .serve-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .timeout-setup {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }
        
        .timeout-setup label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .timeout-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .timeout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            min-width: 30px;
        }
        
        .timeout-btn:hover:not(:disabled) {
            background: #c0392b;
        }
        
        .timeout-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .timeout-display {
            background: white;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
            color: #2c3e50;
            border: 2px solid #3498db;
        }
        
        .court-section {
            margin: 20px 0;
            text-align: center;
        }
        
        .switch-court-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            margin-bottom: 15px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .switch-court-btn:hover {
            background: #c0392b;
        }
        
        .court {
            display: grid;
            grid-template-columns: 3fr 1fr 1fr 3fr;
            grid-template-rows: repeat(2, 80px);
            max-width: 600px;
            margin: 0 auto;
            border: 3px solid white;
            background: white;
        }
        
        .court-cell {
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            font-size: 12px;
            font-weight: bold;
        }
        
        .court-cell.col1 { background: #2980b9; }
        .court-cell.col4 { background: #2980b9; }
        .court-cell.col2, .court-cell.col3 { background: #27ae60; }
        .court-cell.col2.row1 { border-bottom: none; }
        .court-cell.col2.row2 { border-top: none; }
        .court-cell.col3.row1 { border-bottom: none; }
        .court-cell.col3.row2 { border-top: none; }
        
        .player-position {
            position: absolute;
            background: rgba(255,255,255,0.9);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .player-position.left {
            left: -5px;
            transform: translateX(-100%);
        }
        
        .player-position.right {
            right: -5px;
            transform: translateX(100%);
        }
        
        .ball {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #f39c12;
            border-radius: 50%;
            border: 2px solid #e67e22;
            display: none;
            z-index: 10;
        }
        
        .ball.show {
            display: block;
        }
        
        .ball.left {
            left: 20px;
        }
        
        .ball.right {
            right: 20px;
        }
        
        .serving {
            background: #87ceeb !important;
        }
        
        .scoreboard {
            margin: 20px 0;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: repeat(5, auto);
            gap: 10px;
            max-width: 600px;
            margin: 20px auto;
        }
        
        .score-cell {
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            background: #ecf0f1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .team-names {
            font-size: 14px;
            font-weight: bold;
            color: #2c3e50;
            flex-direction: column;
        }
        
        .score {
            font-size: 48px;
            font-weight: bold;
            color: #e74c3c;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .referee-score {
            background: #3498db;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        
        .vs {
            font-size: 24px;
            font-weight: bold;
            color: #34495e;
        }
        
        .serve-info {
            background: #f39c12;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .timeout-game-btn {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .timeout-game-btn:hover:not(:disabled) {
            background: #8e44ad;
        }
        
        .timeout-game-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .timeout-timer {
            font-size: 24px;
            font-weight: bold;
            color: #e74c3c;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #e74c3c;
        }
        
        .action-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .score-btn {
            background: #27ae60;
            color: white;
        }
        
        .score-btn:hover {
            background: #229954;
        }
        
        .miss-btn {
            background: #e74c3c;
            color: white;
        }
        
        .miss-btn:hover {
            background: #c0392b;
        }
        
        .undo-btn {
            background: #f39c12;
            color: white;
        }
        
        .undo-btn:hover {
            background: #e67e22;
        }
        
        .reset-btn {
            background: #34495e;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            transition: all 0.3s;
        }
        
        .reset-btn:hover {
            background: #2c3e50;
            transform: translateY(-2px);
        }
        
        .hidden {
            visibility: hidden;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .title {
                font-size: 20px;
            }
            
            .team-setup {
                grid-template-columns: 1fr;
            }
            
            .court {
                grid-template-rows: repeat(2, 60px);
            }
            
            .scoreboard {
                font-size: 12px;
            }
            
            .score {
                font-size: 36px;
            }
            
            .serve-setup, .timeout-setup {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">TÍNH ĐIỂM TRẬN ĐẤU PICKLEBALL</h1>
        
        <!-- Game Setup -->
        <div class="game-setup">
            <!-- Team Setup -->
            <div class="team-setup">
                <div class="team">
                    <h3>Đội 1</h3>
                    <div class="player-input">
                        <label>VĐV 1:</label>
                        <input type="text" id="team1_player1" maxlength="15" value="VĐV 1">
                    </div>
                    <div class="player-input">
                        <label>VĐV 2:</label>
                        <input type="text" id="team1_player2" maxlength="15" value="VĐV 2">
                    </div>
                </div>
                <div class="team">
                    <h3>Đội 2</h3>
                    <div class="player-input">
                        <label>VĐV 1:</label>
                        <input type="text" id="team2_player1" maxlength="15" value="VĐV 1">
                    </div>
                    <div class="player-input">
                        <label>VĐV 2:</label>
                        <input type="text" id="team2_player2" maxlength="15" value="VĐV 2">
                    </div>
                </div>
            </div>
            
            <!-- Serve Setup -->
            <div class="serve-setup">
                <label>Đội phát bóng trước:</label>
                <button class="serve-btn" id="serveBtn">Đội 1</button>
            </div>
            
            <!-- Timeout Setup -->
            <div class="timeout-setup">
                <label>Số lần yêu cầu nghỉ giữa trận của từng đội:</label>
                <div class="timeout-control">
                    <button class="timeout-btn" id="timeoutMinus">-</button>
                    <div class="timeout-display" id="timeoutDisplay">2</div>
                    <button class="timeout-btn" id="timeoutPlus">+</button>
                </div>
            </div>
        </div>
        
        <!-- Court Section -->
        <div class="court-section">
            <button class="switch-court-btn" id="switchCourtBtn">🔄 Đổi sân</button>
            <div class="court" id="court">
                <!-- Court cells will be generated by JavaScript -->
            </div>
        </div>
        
        <!-- Scoreboard -->
        <div class="scoreboard">
            <!-- Row 1 -->
            <div class="score-cell team-names" id="team1Names">
                <div id="team1Player1Name">VĐV 1</div>
                <div id="team1Player2Name">VĐV 2</div>
            </div>
            <div class="score-cell referee-score" id="refereeScore">0-0-2</div>
            <div class="score-cell team-names" id="team2Names">
                <div id="team2Player1Name">VĐV 1</div>
                <div id="team2Player2Name">VĐV 2</div>
            </div>
            
            <!-- Row 2 -->
            <div class="score-cell score" id="team1Score">0</div>
            <div class="score-cell vs">VS</div>
            <div class="score-cell score" id="team2Score">0</div>
            
            <!-- Row 3 -->
            <div class="score-cell serve-info" id="team1ServeInfo"></div>
            <div class="score-cell" id="timeoutTimer"></div>
            <div class="score-cell serve-info" id="team2ServeInfo"></div>
            
            <!-- Row 4 -->
            <div class="score-cell">
                <button class="timeout-game-btn" id="team1TimeoutBtn">TIMEOUT: 2/2</button>
            </div>
            <div class="score-cell"></div>
            <div class="score-cell">
                <button class="timeout-game-btn" id="team2TimeoutBtn">TIMEOUT: 2/2</button>
            </div>
            
            <!-- Row 5 -->
            <div class="score-cell">
                <button class="action-btn score-btn" id="scoreBtn">Ghi điểm</button>
            </div>
            <div class="score-cell">
                <button class="action-btn undo-btn" id="undoBtn">Undo</button>
            </div>
            <div class="score-cell">
                <button class="action-btn miss-btn" id="missBtn">Không ghi điểm</button>
            </div>
        </div>
        
        <button class="reset-btn" id="resetBtn">🔄 Bắt đầu trận mới</button>
    </div>

    <script>
        // Game state
        let gameState = {
            team1: { score: 0, timeouts: 2 },
            team2: { score: 0, timeouts: 2 },
            servingTeam: 1,
            serveNumber: 2,
            servingPlayer: 1,
            courtSwitched: false,
            gameStarted: false,
            maxTimeouts: 2,
            history: []
        };
        
        let timeoutInterval = null;
        
        // Initialize game
        function initializeGame() {
            createCourt();
            updateDisplay();
            setupEventListeners();
        }
        
        function createCourt() {
            const court = document.getElementById('court');
            court.innerHTML = '';
            
            for (let row = 1; row <= 2; row++) {
                for (let col = 1; col <= 4; col++) {
                    const cell = document.createElement('div');
                    cell.className = `court-cell col${col} row${row}`;
                    cell.id = `cell-${col}-${row}`;
                    
                    // Add ball
                    const ball = document.createElement('div');
                    ball.className = 'ball';
                    ball.id = `ball-${col}-${row}`;
                    cell.appendChild(ball);
                    
                    court.appendChild(cell);
                }
            }
            updatePlayerPositions();
        }
        
        function updatePlayerPositions() {
            // Clear all player positions
            document.querySelectorAll('.player-position').forEach(el => el.remove());
            
            const team1Player1 = document.getElementById('team1_player1').value || 'VĐV 1';
            const team1Player2 = document.getElementById('team1_player2').value || 'VĐV 2';
            const team2Player1 = document.getElementById('team2_player1').value || 'VĐV 1';
            const team2Player2 = document.getElementById('team2_player2').value || 'VĐV 2';
            
            let positions;
            if (!gameState.courtSwitched) {
                positions = [
                    { cell: 'cell-1-2', player: team1Player1, side: 'left', team: 1, playerNum: 1 },
                    { cell: 'cell-1-1', player: team1Player2, side: 'left', team: 1, playerNum: 2 },
                    { cell: 'cell-4-1', player: team2Player1, side: 'right', team: 2, playerNum: 1 },
                    { cell: 'cell-4-2', player: team2Player2, side: 'right', team: 2, playerNum: 2 }
                ];
            } else {
                positions = [
                    { cell: 'cell-4-1', player: team1Player1, side: 'right', team: 1, playerNum: 1 },
                    { cell: 'cell-4-2', player: team1Player2, side: 'right', team: 1, playerNum: 2 },
                    { cell: 'cell-1-2', player: team2Player1, side: 'left', team: 2, playerNum: 1 },
                    { cell: 'cell-1-1', player: team2Player2, side: 'left', team: 2, playerNum: 2 }
                ];
            }
            
            positions.forEach(pos => {
                const cell = document.getElementById(pos.cell);
                const playerDiv = document.createElement('div');
                playerDiv.className = `player-position ${pos.side}`;
                playerDiv.textContent = pos.player;
                cell.appendChild(playerDiv);
                
                // Highlight serving player
                if (pos.team === gameState.servingTeam && pos.playerNum === gameState.servingPlayer) {
                    cell.classList.add('serving');
                    const ball = cell.querySelector('.ball');
                    ball.classList.add('show', pos.side);
                } else {
                    cell.classList.remove('serving');
                    const ball = cell.querySelector('.ball');
                    ball.classList.remove('show', 'left', 'right');
                }
            });
        }
        
        function updateDisplay() {
            // Update team names
            const team1Player1 = document.getElementById('team1_player1').value || 'VĐV 1';
            const team1Player2 = document.getElementById('team1_player2').value || 'VĐV 2';
            const team2Player1 = document.getElementById('team2_player1').value || 'VĐV 1';
            const team2Player2 = document.getElementById('team2_player2').value || 'VĐV 2';
            
            document.getElementById('team1Player1Name').textContent = team1Player1;
            document.getElementById('team1Player2Name').textContent = team1Player2;
            document.getElementById('team2Player1Name').textContent = team2Player1;
            document.getElementById('team2Player2Name').textContent = team2Player2;
            
            // Update scores
            document.getElementById('team1Score').textContent = gameState.team1.score;
            document.getElementById('team2Score').textContent = gameState.team2.score;
            
            // Update referee score (A-B-C format)
            const servingScore = gameState.servingTeam === 1 ? gameState.team1.score : gameState.team2.score;
            const receivingScore = gameState.servingTeam === 1 ? gameState.team2.score : gameState.team1.score;
            document.getElementById('refereeScore').textContent = `${servingScore}-${receivingScore}-${gameState.serveNumber}`;
            
            // Update serve info
            document.getElementById('team1ServeInfo').textContent = '';
            document.getElementById('team2ServeInfo').textContent = '';
            document.getElementById('team1ServeInfo').classList.toggle('hidden', gameState.servingTeam !== 1);
            document.getElementById('team2ServeInfo').classList.toggle('hidden', gameState.servingTeam !== 2);
            
            if (gameState.servingTeam === 1) {
                document.getElementById('team1ServeInfo').textContent = `Lượt phát bóng: ${gameState.serveNumber}/2`;
            } else {
                document.getElementById('team2ServeInfo').textContent = `Lượt phát bóng: ${gameState.serveNumber}/2`;
            }
            
            // Update timeout buttons
            document.getElementById('team1TimeoutBtn').textContent = `TIMEOUT: ${gameState.team1.timeouts}/${gameState.maxTimeouts}`;
            document.getElementById('team2TimeoutBtn').textContent = `TIMEOUT: ${gameState.team2.timeouts}/${gameState.maxTimeouts}`;
            document.getElementById('team1TimeoutBtn').disabled = gameState.team1.timeouts === 0;
            document.getElementById('team2TimeoutBtn').disabled = gameState.team2.timeouts === 0;
            
            // Update serve button state
            document.getElementById('serveBtn').disabled = gameState.gameStarted;
            
            // Update timeout setup display
            document.getElementById('timeoutDisplay').textContent = gameState.maxTimeouts;
            document.getElementById('timeoutMinus').disabled = gameState.maxTimeouts <= 0;
            document.getElementById('timeoutPlus').disabled = gameState.maxTimeouts >= 5;
            
            // Update player positions
            updatePlayerPositions();
        }
        
        function saveState() {
            gameState.history.push(JSON.parse(JSON.stringify(gameState)));
            if (gameState.history.length > 50) {
                gameState.history.shift();
            }
        }
        
        function score() {
            if (!gameState.gameStarted) {
                gameState.gameStarted = true;
            }
            
            saveState();
            
            // Add point to serving team
            if (gameState.servingTeam === 1) {
                gameState.team1.score++;
            } else {
                gameState.team2.score++;
            }
            
            // Switch serving player positions but keep same team serving
            gameState.servingPlayer = gameState.servingPlayer === 1 ? 2 : 1;
            
            updateDisplay();
        }
        
        function miss() {
            if (!gameState.gameStarted) {
                gameState.gameStarted = true;
            }
            
            saveState();
            
            // Increase serve number
            gameState.serveNumber++;
            
            if (gameState.serveNumber === 2) {
                // Same team, switch player
                gameState.servingPlayer = gameState.servingPlayer === 1 ? 2 : 1;
            } else if (gameState.serveNumber === 3) {
                // Switch to other team
                gameState.servingTeam = gameState.servingTeam === 1 ? 2 : 1;
                gameState.serveNumber = 1;
                gameState.servingPlayer = 1;
            }
            
            updateDisplay();
        }
        
        function undo() {
            if (gameState.history.length > 0) {
                const previousState = gameState.history.pop();
                gameState = { ...previousState, history: gameState.history };
                
                // Stop timeout timer
                if (timeoutInterval) {
                    clearInterval(timeoutInterval);
                    timeoutInterval = null;
                    document.getElementById('timeoutTimer').innerHTML = '';
                }
                
                updateDisplay();
            }
        }
        
        function timeout(team) {
            if (team === 1 && gameState.team1.timeouts > 0) {
                gameState.team1.timeouts--;
            } else if (team === 2 && gameState.team2.timeouts > 0) {
                gameState.team2.timeouts--;
            }
            
            startTimeoutTimer();
            updateDisplay();
        }
        
        function startTimeoutTimer() {
            let seconds = 60;
            const timerElement = document.getElementById('timeoutTimer');
            
            if (timeoutInterval) clearInterval(timeoutInterval);
            
            timeoutInterval = setInterval(() => {
                timerElement.innerHTML = `<div class="timeout-timer">${seconds}s</div>`;
                seconds--;
                
                if (seconds < 0) {
                    clearInterval(timeoutInterval);
                    timeoutInterval = null;
                    timerElement.innerHTML = '';
                }
            }, 1000);
        }
        
        function switchCourt() {
            saveState();
            gameState.courtSwitched = !gameState.courtSwitched;
            updateDisplay();
        }
        
        function toggleServingTeam() {
            if (!gameState.gameStarted) {
                gameState.servingTeam = gameState.servingTeam === 1 ? 2 : 1;
                const btn = document.getElementById('serveBtn');
                btn.textContent = `Đội ${gameState.servingTeam}`;
                updateDisplay();
            }
        }
        
        function adjustTimeouts(delta) {
            const newValue = gameState.maxTimeouts + delta;
            if (newValue >= 0 && newValue <= 5) {
                gameState.maxTimeouts = newValue;
                gameState.team1.timeouts = newValue;
                gameState.team2.timeouts = newValue;
                updateDisplay();
            }
        }
        
        function resetGame() {
            if (timeoutInterval) {
                clearInterval(timeoutInterval);
                timeoutInterval = null;
            }
            
            gameState = {
                team1: { score: 0, timeouts: gameState.maxTimeouts },
                team2: { score: 0, timeouts: gameState.maxTimeouts },
                servingTeam: 1,
                serveNumber: 2,
                servingPlayer: 1,
                courtSwitched: false,
                gameStarted: false,
                maxTimeouts: gameState.maxTimeouts,
                history: []
            };
            
            document.getElementById('serveBtn').textContent = 'Đội 1';
            document.getElementById('timeoutTimer').innerHTML = '';
            updateDisplay();
        }
        
        function setupEventListeners() {
            document.getElementById('serveBtn').addEventListener('click', toggleServingTeam);
            document.getElementById('switchCourtBtn').addEventListener('click', switchCourt);
            document.getElementById('scoreBtn').addEventListener('click', score);
            document.getElementById('missBtn').addEventListener('click', miss);
            document.getElementById('undoBtn').addEventListener('click', undo);
            document.getElementById('team1TimeoutBtn').addEventListener('click', () => timeout(1));
            document.getElementById('team2TimeoutBtn').addEventListener('click', () => timeout(2));
            document.getElementById('resetBtn').addEventListener('click', resetGame);
            
            // Timeout setup controls
            document.getElementById('timeoutMinus').addEventListener('click', () => adjustTimeouts(-1));
            document.getElementById('timeoutPlus').addEventListener('click', () => adjustTimeouts(1));
            
            // Player name change listeners
            ['team1_player1', 'team1_player2', 'team2_player1', 'team2_player2'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateDisplay);
            });
        }
        
        // Initialize the game when page loads
        initializeGame();
    </script>
</body>
</html>
